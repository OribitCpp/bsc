// RUN: %clang -rewrite-bsc %s -o %t-rw.c
// RUN: FileCheck --input-file=%t-rw.c %s
// expected-no-diagnostics

void free_owned_new(void * owned p);

typedef struct A {
	int * owned a;
} A;

void test1(A * owned p) {
	#pragma GCC diagnostic push
    #pragma GCC diagnostic ignored "-Ecast-owned"
	free_owned_new((void * owned)p); // invalid cast to `void * owned` of not all moved value: `p`, p.a is owned
	#pragma GCC diagnostic pop
}

// CHECK:      struct A;
// CHECK-NEXT: typedef struct A A;
// CHECK-EMPTY: 
// CHECK:      struct A {
// CHECK-NEXT:     int * a;
// CHECK-NEXT: };
// CHECK-EMPTY: 
// CHECK:      void free_owned_new(void * p);
// CHECK-EMPTY: 
// CHECK:      void test1(A * p) {
// CHECK-NEXT:     free_owned_new((void *)p);
// CHECK-NEXT: }
