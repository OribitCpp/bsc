// RUN: %clang %s -o %t.output
// RUN: %t.output
// RUN: %clang -rewrite-bsc %s -o %t-rw.c
// RUN: %clang %t-rw.c -o %t-rw.output
// RUN: %t-rw.output
// expected-no-diagnostics

typedef MyLongInt = long int;

typedef MyInt_1 = typeof(3 + 5);
typedef MyInt_2 = MyInt_1;

typedef MyType<T> = T;
typedef MyPointerType<T> = T*;
typedef MyArray_5<T> = T[5];
typedef MyArray_N<T, int N> = T[N];

struct S1 {
    MyLongInt a;
};
typedef MyS1 = struct S1;

struct S2<T> {
    T a;
};
typedef MyS2_int = struct S2<int>;
typedef MyS2_long_int = struct S2<MyLongInt>;
typedef MyS2_T<T> = struct S2<T*>;

struct S3<T1, T2> {
    T1 a;
    T2 b;
};
typedef MyS3_int_long_int = struct S3<int, MyLongInt>;
typedef MyS3_T1_T2<T1, T2> = struct S3<T1, T2>;
typedef MyS3_T_T<T> = struct S3<T, T>;
typedef MyS3_T_int<T> = struct S3<T, int>;
typedef MyS3_T_S2<T> = struct S3<T, struct S2<T>>;
typedef MyS3_T1_S2<T1, T2> = struct S3<T1, struct S2<T2>>;
typedef MyS3_T_S2_int<T> = struct S3<T, struct S2<int>>;
typedef MyS3_int_S2<T> = struct S3<int, struct S2<T>>;

struct S4<T, int N> {
    T a[N];
};
typedef MyS4_int_5 = struct S4<int, 5>;
typedef MyS4_T_N<T, int N> = struct S4<T, N>;
typedef MyS4_T_5<T> = struct S4<T, 5>;
typedef MyS4_int_N<int N> = struct S4<int, N>;
typedef MyS4_S2_int_N<int N> = struct S4<struct S2<int>, N>;
typedef MyS4_S2_N<T, int N> = struct S4<struct S2<T>, N>;

int main() {
    MyLongInt c = 5;
    MyInt_1 d = 5;
    MyInt_2 e = 5;

    MyType<int> f = 5;
    MyPointerType<int> g = &f;
    MyArray_5<int> h = { 1, 2, 3, 4, 5 };
    MyArray_N<int, 5> i = { 1, 2, 3, 4, 5 };
    
    struct S1 s1 = { .a = 10 };
    MyS1 s2 = s1;
    
    struct S2<int> s3 = { .a = 10 };
    struct S2<MyLongInt> s4 = { .a = 10 };
    MyS2_int s5 = s3;
    MyS2_long_int s6 = s4;
    MyS2_T<int> s7 = { .a = &d };
    MyS2_T<MyLongInt> s8 = { .a = &c };

    struct S3<int, MyLongInt> s9 = { .a = 10, .b = 10 };
    struct S3<int, int> s10 = { .a = 10, .b = 10 };
    MyS3_int_long_int s11 = s9;
    MyS3_T1_T2<int, MyLongInt> s12 = s9;
    MyS3_T1_T2<int, int> s13 = s10;
    MyS3_T_T<int> s14 = s10;
    MyS3_T_int<int> s15 = s10;
    MyS3_T_S2<int> s16 = { .a = 10, .b = s3 };
    MyS3_T1_S2<int, MyLongInt> s17 = { .a = 10, .b = s4 };
    MyS3_T_S2_int<int> s18 = s16;
    MyS3_int_S2<MyLongInt> s19 = s17;

    struct S4<int, 5> s20 = { .a = { 1, 2, 3, 4, 5 } };
    MyS4_int_5 s21 = s20;
    MyS4_T_N<int, 5> s22 = s20;
    MyS4_T_N<struct S2<int>, 5> s23 = { .a = { s3, s3, s3, s3, s3 } };
    MyS4_T_5<int> s24 = s20;
    MyS4_int_N<5> s25 = s20;
    MyS4_S2_int_N<5> s26 = s23;
    MyS4_S2_N<int, 5> s27 = s23;    
    return 0;
}