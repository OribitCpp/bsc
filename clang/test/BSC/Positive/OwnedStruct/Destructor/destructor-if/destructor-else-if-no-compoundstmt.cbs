// RUN: %clang %s -o %test.output
// RUN: %test.output
// RUN: %clang -rewrite-bsc %s -o %t-rw.c
// RUN: FileCheck --input-file=%t-rw.c %s
// RUN: %clang %t-rw.c -o %t-rw.output
// RUN: %t-rw.output

int g_flag = 0x2;
owned struct S {
public:
    ~S(S this) {
        g_flag--;
    }
};
int foo() {
  if (0) 
    S s1 = {};
   else if (1)
    S s1 = {};
  return 0;
}

int goo() {
  if (0) 
    S s1 = {};
  else if (0)
    S s1 = {};
  else 
    S s1 = {};
  
  return 0;
}
int main() {
    foo();
    goo();
    return g_flag;
}

// CHECK:struct S {
// CHECK-NEXT:};
// CHECK-EMPTY:
// CHECK-NEXT:void struct_S_D( struct S this);
// CHECK-EMPTY:
// CHECK-NEXT:int g_flag = 2;
// CHECK-EMPTY:
// CHECK-NEXT:int foo(void) {
// CHECK-NEXT:    if (0) {
// CHECK-NEXT:         struct S s1 = {};
// CHECK-NEXT:        _Bool s1_is_moved = 0;
// CHECK-NEXT:        if (!s1_is_moved)
// CHECK-NEXT:            struct_S_D(s1);
// CHECK-NEXT:    } else if (1) {
// CHECK-NEXT:         struct S s1 = {};
// CHECK-NEXT:        _Bool s1_is_moved = 0;
// CHECK-NEXT:        if (!s1_is_moved)
// CHECK-NEXT:            struct_S_D(s1);
// CHECK-NEXT:    }
// CHECK-NEXT:    return 0;
// CHECK-NEXT:}
// CHECK-EMPTY:
// CHECK-NEXT:int goo(void) {
// CHECK-NEXT:    if (0) {
// CHECK-NEXT:         struct S s1 = {};
// CHECK-NEXT:        _Bool s1_is_moved = 0;
// CHECK-NEXT:        if (!s1_is_moved)
// CHECK-NEXT:            struct_S_D(s1);
// CHECK-NEXT:    } else if (0) {
// CHECK-NEXT:         struct S s1 = {};
// CHECK-NEXT:        _Bool s1_is_moved = 0;
// CHECK-NEXT:        if (!s1_is_moved)
// CHECK-NEXT:            struct_S_D(s1);
// CHECK-NEXT:    } else {
// CHECK-NEXT:         struct S s1 = {};
// CHECK-NEXT:        _Bool s1_is_moved = 0;
// CHECK-NEXT:        if (!s1_is_moved)
// CHECK-NEXT:            struct_S_D(s1);
// CHECK-NEXT:    }
// CHECK-NEXT:    return 0;
// CHECK-NEXT:}
// CHECK-EMPTY:
// CHECK-NEXT:int main() {
// CHECK-NEXT:    foo();
// CHECK-NEXT:    goo();
// CHECK-NEXT:    return g_flag;
// CHECK-NEXT:}
// CHECK-EMPTY:
// CHECK-NEXT:void struct_S_D( struct S this) {
// CHECK-NEXT:    _Bool this_is_moved = 0;
// CHECK-NEXT:    g_flag--;
// CHECK-NEXT:}