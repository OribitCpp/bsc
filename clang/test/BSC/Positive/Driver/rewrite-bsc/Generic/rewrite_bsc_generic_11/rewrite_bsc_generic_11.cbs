// RUN: %clang -rewrite-bsc %s -o %t-rw.c
// RUN: FileCheck --input-file=%t-rw.c %s
// RUN: %clang %t-rw.c -o %t-rw.output
// RUN: %t-rw.output

int int::increase(int* this) {
  return *this += 1;
}

static T1 max<T1>(T1 a) {
  int x = 1;
  int::increase(&x);
  int b = x.increase();
  return a > b ? a : b;
}

int main() {
  int a1 = 1;
  int b1 = 2;
  b1.increase();
  int::increase(&b1);
  int c1 = max<int>(a1);
  float c2 = max<float>(1.0);
  return 0;
}

// CHECK:static int max_int(int a);
// CHECK-EMPTY:
// CHECK-NEXT:static float max_float(float a);
// CHECK-EMPTY:
// CHECK-NEXT:int int_increase(int *this) {
// CHECK-NEXT:  return *this += 1;
// CHECK-NEXT:}
// CHECK-EMPTY:
// CHECK-NEXT:int main(void) {
// CHECK-NEXT:  int a1 = 1;
// CHECK-NEXT:  int b1 = 2;
// CHECK-NEXT:  int_increase(&b1);
// CHECK-NEXT:  int_increase(&b1);
// CHECK-NEXT:  int c1 = max_int(a1);
// CHECK-NEXT:  float c2 = max_float(1.);
// CHECK-NEXT:  return 0;
// CHECK-NEXT:}
// CHECK-EMPTY:
// CHECK-NEXT:static int max_int(int a) {
// CHECK-NEXT:      int x = 1;
// CHECK-NEXT:      int_increase(&x);
// CHECK-NEXT:      int b = int_increase(&x);
// CHECK-NEXT:      return a > b ? a : b;
// CHECK-NEXT:  }
// CHECK-EMPTY:
// CHECK-NEXT:static float max_float(float a) {
// CHECK-NEXT:      int x = 1;
// CHECK-NEXT:      int_increase(&x);
// CHECK-NEXT:      int b = int_increase(&x);
// CHECK-NEXT:      return a > b ? a : b;
// CHECK-NEXT:  }