// RUN: %clang_cc1 -verify %s
// RUN: %clang -rewrite-bsc %s -o %t-rw.c
// RUN: FileCheck --input-file=%t-rw.c %s
// RUN: %clang %t-rw.c -o %t-rw.output
// RUN: %t-rw.output
// RUN: %clang -rewrite-bsc -line %s -o %t-rwline.c
// RUN: FileCheck --input-file=%t-rwline.c %s --check-prefix=CHECK-L
// expected-no-diagnostics

struct Foo {
  int a;
};

int struct Foo::getA(This this) {
  return this.a;
}

int struct Foo::getB(This* this) {
  return this->a;
}

int struct Foo::getC(struct Foo* this) {
  return this->a;
}

int struct Foo::getD(struct Foo this) {
  return this.a;
}

int struct Foo::getE(struct Foo f) {
  return f.a;
}

int main() {
  struct Foo foo = {.a = 1};
  int a = foo.getA();
  int b = foo.getB();
  int c = foo.getC();
  int d = foo.getD();
  int f = struct Foo::getE(foo);
  return 0;
}

// CHECK: struct Foo {
// CHECK-NEXT:   int a;
// CHECK-NEXT: };

// CHECK-L: #line 14 "{{.*}}.cbs"
// CHECK: int struct_Foo_getA(struct Foo this) {
// CHECK-NEXT:   return this.a;
// CHECK-NEXT: }
// CHECK-EMPTY:

// CHECK-L: #line 18 "{{.*}}.cbs"
// CHECK: int struct_Foo_getB(struct Foo *this) {
// CHECK-NEXT:   return this->a;
// CHECK-NEXT: }
// CHECK-EMPTY:

// CHECK-L: #line 22 "{{.*}}.cbs"
// CHECK: int struct_Foo_getC(struct Foo *this) {
// CHECK-NEXT:   return this->a;
// CHECK-NEXT: }
// CHECK-EMPTY:

// CHECK-L: #line 26 "{{.*}}.cbs"
// CHECK: int struct_Foo_getD(struct Foo this) {
// CHECK-NEXT:   return this.a;
// CHECK-NEXT: }
// CHECK-EMPTY:

// CHECK-L: #line 30 "{{.*}}.cbs"
// CHECK: int struct_Foo_getE(struct Foo f) {
// CHECK-NEXT:   return f.a;
// CHECK-NEXT: }
// CHECK-EMPTY:

// CHECK: int main(void) {
// CHECK-NEXT:   struct Foo foo = {.a = 1};
// CHECK-NEXT:   int a = struct_Foo_getA(foo);
// CHECK-NEXT:   int b = struct_Foo_getB(&foo);
// CHECK-NEXT:   int c = struct_Foo_getC(&foo);
// CHECK-NEXT:   int d = struct_Foo_getD(foo);
// CHECK-NEXT:   int f = struct_Foo_getE(foo);
// CHECK-NEXT:   return 0;
// CHECK-NEXT: }
