// RUN: %clang %s -o %t.output
// RUN: %t.output
// expected-no-diagnostics

#define NULL ((void*)0)

struct K<T> {
    T a;
};

void struct K<T>::foo1(const This *borrow this) {
    struct K<T> ret = *this;    
}

void struct K<T>::foo2(This *borrow this) {
    struct K<T> ret = *this;
}

struct M<T> {
    struct K<T>*borrow a;
};

void struct M<T>::foo3(This *this) {
    struct K<T> ret = *(this->a);
}

void foo<T>(struct K<T> *borrow p) {
    struct K<T> ret = *p;
    T *a = (T*)ret.a;    
}

typedef struct BinaryTrieNode {
    struct BinaryTrieNode *zero;
    struct BinaryTrieNode *one;
} BinTrieNode;

void BinTrieDestroy(BinTrieNode **root)
{
    if (*root == NULL) {
        return;
    }
}

int main() {
    struct K<int> k = { .a = 5 };
    k.foo1();
    k.foo2();

    struct M<int> m = { .a = &mut k };
    m.foo3();
    return 0;
}